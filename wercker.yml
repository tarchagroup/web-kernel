box: wercker/php
build:
    steps:
      - add-ssh-key:
          keyname: TARCHABOT_KEY
      - mbrevda/composer-install
      - script:
          name: phplint
          code: ./vendor/bin/parallel-lint --exclude vendor .
      - mbrevda/phpcs:
            directory: src/
      - script:
          name: json lint
          code: >
            find . -name '*.json' ! -path '*vendor*' 
            -print0 | xargs -0 -I % 
            sh -c 'echo -n %... ; vendor/bin/jsonlint %'
      - mbrevda/phpcs:
          directory: src/
      - script:
          name: phpunit
          code: ./tests/phpunit.sh
    after-steps:
        - slack-notifier:
            url: $SLACK_WEBHOOK_URL
